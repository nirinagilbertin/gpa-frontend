<div class="container mt-4">
  <!-- HEADER -->
  <div class="dashboard-header">
    <h3 class="dashboard-title">Statistique</h3>
    <button class="btn-refresh" (click)="loadData()" [disabled]="isLoading">
      <i class="bi bi-arrow-clockwise" [class.spin]="isLoading"></i>
      Actualiser
    </button>
  </div>

  <!-- === INDICATEURS PRINCIPAUX === -->
  <div class="row g-3 mb-4">
  
    <!-- Dépenses Totales -->
    <div class="col-xl-3 col-md-6">
      <div class="card dashboard-card h-100">
        <div class="card-body d-flex justify-content-between align-items-center">
          <div>
            <h6 class="card-title text-muted mb-2">Dépenses Totales</h6>
            <h3 class="fw-bold text-danger">{{ totalDepenses | number:'1.0-0' }} €</h3>
          </div>
          <div class="icon-container bg-light-danger">
            <i class="bi bi-cash-stack text-danger fs-4"></i>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Moyenne Journalière -->
    <div class="col-xl-3 col-md-6">
      <div class="card dashboard-card h-100">
        <div class="card-body d-flex justify-content-between align-items-center">
          <div>
            <h6 class="card-title text-muted mb-2">Moyenne Journalière</h6>
            <h3 class="fw-bold text-danger">{{ averageDailyKm }} km</h3>
          </div>
          <div class="icon-container bg-light-danger">
            <i class="bi bi-speedometer2 text-danger fs-4"></i>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Total Kilométrage -->
    <div class="col-xl-3 col-md-6">
      <div class="card dashboard-card h-100">
        <div class="card-body d-flex justify-content-between align-items-center">
          <div>
            <h6 class="card-title text-muted mb-2">Total Kilométrage</h6>
            <h3 class="fw-bold text-danger">{{ totalKilometres | number }} km</h3>
          </div>
          <div class="icon-container bg-light-danger">
            <i class="bi bi-map text-danger fs-4"></i>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Véhicule le plus utilisé -->
    <div class="col-xl-3 col-md-6">
      <div class="card dashboard-card h-100">
        <div class="card-body d-flex justify-content-between align-items-center">
          <div>
            <h6 class="card-title text-muted mb-2">Véhicule le plus utilisé</h6>
            <h5 class="fw-bold text-danger" [title]="vehiculePlusUtilise">{{ vehiculePlusUtilise }}</h5>
          </div>
          <div class="icon-container bg-light-danger">
            <i class="bi bi-car-front text-danger fs-4"></i>
          </div>
        </div>
      </div>
    </div>
  
  </div>


  <!-- === ETATS === -->
  <div *ngIf="isLoading" class="state loading">
    <div class="spinner-border text-danger" role="status"></div>
    <p>Chargement des données statistiques...</p>
  </div>

  <div *ngIf="!isLoading && !hasData" class="state empty">
    <i class="bi bi-bar-chart"></i>
    <h4>Aucune donnée disponible</h4>
    <p>Les graphiques s'afficheront lorsque des données seront ajoutées.</p>
  </div>

  <div *ngIf="!isLoading && hasData" class="row g-4">

    <!-- Performance & Répartition -->
    <div class="col-lg-8 col-12">
      <div class="card border-0 shadow-sm h-100 chart-card">
        <div class="card-header bg-white border-0">
          <h5 class="mb-0"><i class="bi bi-graph-up me-2"></i>Performance et Coûts Mensuels</h5>
        </div>
        <div class="card-body">
          <canvas #chartCouts></canvas>
        </div>
      </div>
    </div>

    <div class="col-lg-4 col-12">
      <div class="card border-0 shadow-sm h-100 chart-card">
        <div class="card-header bg-white border-0">
          <h5 class="mb-0"><i class="bi bi-pie-chart me-2"></i>Répartition des Dépenses</h5>
        </div>
        <div class="card-body d-flex align-items-center justify-content-center">
          <canvas #chartCarburant></canvas>
        </div>
        <div class="card-footer bg-white border-0" *ngIf="repartitionDepenses.length > 0">
          <div class="row text-center">
            <div class="col-6" *ngFor="let depense of repartitionDepenses">
              <div class="fw-bold" [style.color]="depense.couleur">
                {{ depense.montant | number:'1.0-0' }} €
              </div>
              <small class="text-muted">{{ depense.label }}</small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Kilométrage Mensuel et Top Véhicules -->
    <div class="col-lg-6 col-12">
      <div class="card border-0 shadow-sm h-100 chart-card">
        <div class="card-header bg-white border-0">
          <h5 class="mb-0"><i class="bi bi-speedometer me-2"></i>Kilométrage Mensuel</h5>
        </div>
        <div class="card-body">
          <canvas #chartKm></canvas>
        </div>
      </div>
    </div>

    <div class="col-lg-6 col-12">
      <div class="card border-0 shadow-sm h-100 chart-card">
        <div class="card-header bg-white border-0">
          <h5 class="mb-0"><i class="bi bi-trophy me-2"></i>Top Véhicules</h5>
        </div>
        <div class="card-body">
          <canvas #chartTopVehicules></canvas>
        </div>
      </div>
    </div>

    <!-- Activité récente -->
    <div class="col-12">
      <div class="card border-0 shadow-sm h-100 chart-card">
        <div class="card-header bg-white border-0">
          <h5 class="mb-0"><i class="bi bi-activity me-2"></i>Activité Récente</h5>
        </div>
        <div class="card-body">
          <canvas #chartTrajets></canvas>
        </div>
      </div>
    </div>

  </div>

</div>